<script>
  const apiBase = "https://email-scheduler-7fxr.onrender.com";

  const typeSelect = document.getElementById("type");
  const emailForm = document.getElementById("emailForm");
  const smsForm = document.getElementById("smsForm");
  const responseEl = document.getElementById("response");

  // Toggle forms based on type
  typeSelect.addEventListener("change", () => {
    if (typeSelect.value === "email") {
      emailForm.classList.remove("hidden");
      smsForm.classList.add("hidden");
    } else {
      emailForm.classList.add("hidden");
      smsForm.classList.remove("hidden");
    }
    responseEl.innerText = "";
  });

  // Email form submit
  emailForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const to = document.getElementById("emailTo").value;
    const subject = document.getElementById("emailSubject").value;
    const text = document.getElementById("emailText").value;
    const dateTime = document.getElementById("emailDateTime").value;

    try {
      const res = await fetch(`${apiBase}/schedule`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ to, subject, message: text, scheduleTime: dateTime })
      });
      const data = await res.json();
      responseEl.innerText = data.message || data.error;
    } catch (err) {
      responseEl.innerText = "❌ Failed to schedule email";
    }
  });

  // SMS form submit
  smsForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const to = document.getElementById("smsTo").value;
    const message = document.getElementById("smsMessage").value;
    const dateTime = document.getElementById("smsDateTime").value;

    try {
      const res = await fetch(`${apiBase}/schedule`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ to, message, scheduleTime: dateTime })
      });
      const data = await res.json();
      responseEl.innerText = data.message || data.error;
    } catch (err) {
      responseEl.innerText = "❌ Failed to schedule SMS";
    }
  });
</script>
